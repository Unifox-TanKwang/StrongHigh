# Basics

### To do

1. x86 아키텍쳐 cpu 레지스터
2. 스택프레임과 함수 프롤로그, 에필로그
3. 함수 호출규약
4. cpu caching

## 1. x86 아키텍쳐 cpu 레지스터

#### 범용 레지스터

- EAX : 함수의 리턴값을 저장,각종 산술연산에 사용.
- EBX : 특정 메모리를 가리키는 포인터, 간접 주소 연산에 사용됨.
- ECX : 반복문 등의 사용시, 반복횟수를 셈 .
- EDX : 데이터 기록.

#### 주소 레지스터 (인덱스)

- ESI :데이터를 편집, 복사할 때 주소 저장.
- EDI : 데이터를 복사할 때 목적지의 주소 저장.

#### 주소 레지스터 (포인터)

- ESP : 스택의 크기, 스택의 최하단.
- EBP : 스택의 시작주소, 스택의 최상단.
- EIP : 다음 실행할 명령어가 존재하는 메모리 주소를 저장.

#### 세그먼트 레지스터

- CS : 코드 영역의 시작주소 .
- DS : 데이터 영역의 시작주소.
- SS : 스택 영역의 시작주소.

## 2. 스택프레임과 함수 프롤로그, 에필로그

#### 스택 프레임(stack frame)

함수가 호출되면 스택에는 함수의 매개변수, 호출이 끝난 뒤 돌아갈 반환 주소값, 함수에서 선언된 지역 변수 등이 저장된다. 이렇게 스택 영역에 차례대로 저장되는 함수의 호출 정보를 스택 프레임(stack frame)이라고 한다.

#### 프롤로그 (prolog)

프롤로그는 스택 프레임을 생성하기 위한 과성이다.

어셈블리로 다음처럼 표현한다.

```
push ebp 
mov ebp,esp
```

#### 에필로그(epilog)

에필로그는 프롤로그와 반대로, 스택 프레임을 해제하기 위한 과정이다.

함수 호출이 끝나고 원래 지점으로 돌아가기 위해 스택을 복원한다.

```
// leave
mov esp, ebp
pop ebp

// ret
pop eip
jmp eip
```

## 3. 함수 호출규약

#### 함수 호출규약

함수 호출 규약이란 호출자와 피호출자 간에 '함수를 호출할 때 전달되는 인자의 순서나 사용이 끝나고 나서의 스택 정리 등'에 대한 약속

#### __cdecl 방식

- 오른쪽에서 왼쪽으로 인자가 차례대로 스택에 적재된다. 

- 호출자가 피호출자의 스택 프레임을 정리한다.

#### __stdcall 방식

- 오른쪽에서 왼쪽으로 인자가 차례대로 스택에 적재된다. 

- 피호출에서 스택을 정리한다.

#### __fastcall 방식

- 오른쪽에서 왼쪽으로 인자가 차례대로 스택에 적재된다. 

- 스택이 아닌 스택에 가장 가까운 레지스터를 사용한다. (ECD, EDX)

## CPU Cashing

